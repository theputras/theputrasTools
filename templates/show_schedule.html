<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Jadwal & Sicyca</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-900 text-gray-300 font-sans">
    <div class="container mx-auto p-6">
        
        <!-- HEADER STATUS -->
        <div class="bg-gray-800 rounded-lg shadow-md p-6 flex flex-wrap items-center gap-4 justify-start"
             x-data="{ jadwalStatus: 'loading', jadwalMsg: '', sicycaStatus: 'loading', sicycaMsg: '', lastUpdate: '' }"
             x-init="
                fetch('/api/jadwal-status')
                    .then(res => res.json())
                    .then(data => { 
                        jadwalStatus = data.status; 
                        jadwalMsg = data.message; 
                        lastUpdate = data.message; 
                    });
                fetch('/api/status_koneksi')
                    .then(res => res.json())
                    .then(data => { sicycaStatus = data.status; sicycaMsg = data.message; });
                setInterval(() => {
                    fetch('/api/jadwal-status')
                        .then(res => res.json())
                        .then(data => { 
                            jadwalStatus = data.status; 
                            jadwalMsg = data.message; 
                            lastUpdate = data.message; 
                        });
                }, 5000);
             ">
             
            <a href="/pencarian-komunitas" class="text-blue-400 hover:text-blue-300 font-semibold underline">
                &raquo; Pencarian Komunitas
            </a>

            <a href="/refresh-jadwal" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-md text-sm">
                &#x21bb; Refresh Jadwal
            </a>

            <a href="/log-program" class="text-gray-400 hover:text-gray-300 underline text-sm">
                Lihat Log
            </a>

            <!-- STATUS JADWAL -->
            <template x-if="jadwalStatus === 'loading'">
                <span class="flex items-center text-xs font-semibold bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded-full">
                    <svg class="animate-spin h-3 w-3 mr-2 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                    </svg>
                    Scraping...
                </span>
            </template>

            <template x-if="jadwalStatus === 'ready'">
                <span class="flex items-center text-xs font-semibold bg-green-500/20 text-green-400 px-3 py-1 rounded-full" :title="jadwalMsg">
                    <span class="h-2 w-2 mr-2 rounded-full bg-green-500"></span>
                    Jadwal Ready
                </span>
            </template>

            <template x-if="jadwalStatus === 'error'">
                <span class="flex items-center text-xs font-semibold bg-red-500/20 text-red-400 px-3 py-1 rounded-full" :title="jadwalMsg">
                    <span class="h-2 w-2 mr-2 rounded-full bg-red-500 animate-pulse"></span>
                    Scraping Error
                </span>
            </template>

            <!-- STATUS SICYCA -->
            <template x-if="sicycaStatus === 'loading'">
                <span class="flex items-center text-xs font-semibold bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded-full">
                    <svg class="animate-spin h-3 w-3 mr-2 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                    </svg>
                    Mengecek koneksi...
                </span>
            </template>

            <template x-if="sicycaStatus === 'ready'">
                <span class="flex items-center text-xs font-semibold bg-green-500/20 text-green-400 px-3 py-1 rounded-full" :title="sicycaMsg">
                    <span class="h-2 w-2 mr-2 rounded-full bg-green-500"></span>
                    Sicyca Ready
                </span>
            </template>

            <template x-if="sicycaStatus === 'error'">
                <span class="flex items-center text-xs font-semibold bg-red-500/20 text-red-400 px-3 py-1 rounded-full" :title="sicycaMsg">
                    <span class="h-2 w-2 mr-2 rounded-full bg-red-500 animate-pulse"></span>
                    Connection Error
                </span>
            </template>
        </div>

        <!-- AREA TABEL -->
        <div class="bg-gray-800 rounded-lg shadow-md p-6 mt-6 overflow-x-auto" x-data="{ lastUpdate: '' }">

            {{ tabel | safe }}
        </div>
    </div>
</body>
</html>